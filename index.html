<script>
    // *** AGENDA DE DEZEMBRO DE 2025 - TOTALMENTE ATUALIZADA ***
    const AGENDA_DATA = [
        // Dia 01 (Segunda-feira)
        { "date": "01/Dez (Segunda-feira)", "time": "--", "title": "Atendimento Hora Marcada", "location": "Atendimento Hora Marcada" },
        { "date": "01/Dez (Segunda-feira)", "time": "14:00", "title": "Atendimento", "location": "Atendimento" },
        { "date": "01/Dez (Segunda-feira)", "time": "19:00", "title": "4º dia da Novena", "location": "Novena" },
        // Dia 02 (Terça-feira)
        { "date": "02/Dez (Terça-feira)", "time": "09:00", "title": "Visita às obras", "location": "Visita às obras" },
        { "date": "02/Dez (Terça-feira)", "time": "14:00", "title": "Atendimento", "location": "Atendimento" },
        { "date": "02/Dez (Terça-feira)", "time": "19:00", "title": "Santa Missa Setor 5 – Bairro Morangal", "location": "Setor 5 – Bairro Morangal" },
        { "date": "02/Dez (Terça-feira)", "time": "19:00", "title": "5º dia da Novena", "location": "Novena" },
        // Dia 03 (Quarta-feira)
        { "date": "03/Dez (Quarta-feira)", "time": "09:00", "title": "Atendimento", "location": "Atendimento" },
        { "date": "03/Dez (Quarta-feira)", "time": "14:00", "title": "Atendimento", "location": "Atendimento" },
        { "date": "03/Dez (Quarta-feira)", "time": "19:00", "title": "Santa Missa Setor 6 – Bairro Torres", "location": "Setor 6 – Bairro Torres" },
        { "date": "03/Dez (Quarta-feira)", "time": "19:00", "title": "6º dia da Novena", "location": "Novena" },
        // Dia 04 (Quinta-feira)
        { "date": "04/Dez (Quinta-feira)", "time": "09:00", "title": "Atendimento", "location": "Atendimento" },
        { "date": "04/Dez (Quinta-feira)", "time": "09:00", "title": "Santa Missa Abrigo São Camilo", "location": "Abrigo São Camilo" },
        { "date": "04/Dez (Quinta-feira)", "time": "14:00", "title": "Visita aos enfermos", "location": "Visita aos enfermos" },
        { "date": "04/Dez (Quinta-feira)", "time": "19:00", "title": "Santa Missa Setor 7 – Bairro Vargem Alegre – Formatura", "location": "Setor 7 – Bairro Vargem Alegre" },
        { "date": "04/Dez (Quinta-feira)", "time": "19:00", "title": "7º dia da Novena", "location": "Novena" },
        // Dia 05 (Sexta-feira)
        { "date": "05/Dez (Sexta-feira)", "time": "09:00", "title": "Atendimento", "location": "Atendimento" },
        { "date": "05/Dez (Sexta-feira)", "time": "14:00", "title": "Visita às obras", "location": "Visita às obras" },
        { "date": "05/Dez (Sexta-feira)", "time": "19:00", "title": "8º dia da Novena", "location": "Novena" },
        { "date": "05/Dez (Sexta-feira)", "time": "--", "title": "Compromisso", "location": "Compromisso" },
        // Dia 06 (Sábado)
        { "date": "06/Dez (Sábado)", "time": "11:00", "title": "Casamento - Igreja Matriz", "location": "Igreja Matriz" },
        { "date": "06/Dez (Sábado)", "time": "16:00", "title": "Santa Missa Igreja Matriz", "location": "Igreja Matriz" },
        { "date": "06/Dez (Sábado)", "time": "18:00", "title": "Vigília Batismal", "location": "Igreja Matriz" },
        { "date": "06/Dez (Sábado)", "time": "19:00", "title": "9º dia da Novena", "location": "Novena" },
        // Dia 07 (Domingo)
        { "date": "07/Dez (Domingo)", "time": "07:00", "title": "Santa Missa Igreja Matriz", "location": "Igreja Matriz" },
        { "date": "07/Dez (Domingo)", "time": "08:00", "title": "Santa Missa Setor 6 – Bairro São José da Mantiqueira - Confissão Crismando", "location": "Setor 6 – Bairro São José da Mantiqueira" },
        { "date": "07/Dez (Domingo)", "time": "09:00", "title": "Santa Missa Igreja Matriz", "location": "Igreja Matriz" },
        { "date": "07/Dez (Domingo)", "time": "10:00", "title": "Batizado – Igreja Matriz", "location": "Igreja Matriz" },
        { "date": "07/Dez (Domingo)", "time": "10:30", "title": "Santa Missa Setor 7 – Bairro Rio Acima II", "location": "Setor 7 – Bairro Rio Acima II" },
        { "date": "07/Dez (Domingo)", "time": "16:00", "title": "Santa Missa Setor 1 – Bairro Retirinho", "location": "Setor 1 – Bairro Retirinho" },
        { "date": "07/Dez (Domingo)", "time": "19:00", "title": "Primeiras Vésperas", "location": "Igreja Matriz" },
        // Dia 08 (Segunda-feira)
        { "date": "08/Dez (Segunda-feira)", "time": "--", "title": "Atendimento Hora Marcada", "location": "Atendimento Hora Marcada" },
        { "date": "08/Dez (Segunda-feira)", "time": "10:00", "title": "Santa Missa Setor 7 – Bairro Roseirinha", "location": "Setor 7 – Bairro Roseirinha" },
        { "date": "08/Dez (Segunda-feira)", "time": "10:00", "title": "Santa Missa Igreja Matriz", "location": "Igreja Matriz" },
        { "date": "08/Dez (Segunda-feira)", "time": "19:00", "title": "Santa Missa Igreja Matriz", "location": "Igreja Matriz" }
    ];

    let uniqueDates = [];
    let currentTab = 'agenda'; 
    let currentSelectedDate = ''; 
    let isMenuOpen = false;

    // Corrigido para DEZEMBRO
    function getUniqueDates() {
        const dates = AGENDA_DATA.map(item => item.date.trim());
        uniqueDates = [...new Set(dates)];
        if (uniqueDates.length > 0) {
            const today = new Date(); // Hoje é 01/Dez/2025 (conforme seu contexto)
            const todayDay = today.getDate().toString().padStart(2, '0');
            // Agora busca por '/Dez'
            let closestDate = uniqueDates[0];
            for (const fullDate of uniqueDates) {
                if (fullDate.includes(todayDay + '/Dez')) {
                    closestDate = fullDate;
                    break;
                }
            }
            if (currentSelectedDate === '') {
                currentSelectedDate = closestDate; 
            }
        }
    }

    function renderDatePicker() {
        getUniqueDates();
        const container = document.getElementById('date-picker-container');
        if (!container) return; 
        container.innerHTML = '';
        uniqueDates.forEach(fullDate => {
            const datePart = fullDate.split('/')[0];
            const button = document.createElement('button');
            button.className = 'date-button';
            button.textContent = datePart;
            button.setAttribute('data-full-date', fullDate);
            if (fullDate === currentSelectedDate) {
                button.classList.add('active');
            }
            button.onclick = () => selectDate(fullDate);
            container.appendChild(button);
        });
        const activeBtn = container.querySelector('.date-button.active');
        if (activeBtn) {
            activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    }

    function selectDate(fullDate) {
        currentSelectedDate = fullDate;
        renderAgenda(); 
        renderDatePicker(); 
    }

    function renderAgenda() {
        const container = document.getElementById('agenda-content');
        if (!container) return;
        container.innerHTML = '';
        const filteredData = AGENDA_DATA.filter(event => event.date.trim() === currentSelectedDate);
        if (filteredData.length === 0) {
            container.innerHTML = `<div class="p-6 card rounded-xl shadow-md text-center text-gray-500">
                <p>Nenhum evento agendado para esta data.</p>
            </div>`;
            return;
        }

        const headerDiv = document.createElement('div');
        headerDiv.className = 'mb-4 text-center';
        const dayOfWeek = currentSelectedDate.split('(')[1].replace(')', '');
        const dateOnly = currentSelectedDate.split('(')[0].trim();
        headerDiv.innerHTML = `
            <p class="text-xl font-bold text-amber-100">${dayOfWeek}</p>
            <p class="text-3xl font-extrabold text-amber-200">${dateOnly}</p>
        `;
        container.appendChild(headerDiv);

        const listCard = document.createElement('div');
        listCard.className = 'card rounded-xl shadow-lg p-4 space-y-2';
        filteredData.forEach(event => {
            const eventDiv = document.createElement('div');
            eventDiv.className = 'flex justify-between items-center py-3 border-b border-gray-700 last:border-b-0';
            const isMatriz = event.title.includes("Igreja Matriz") || event.location.includes("Igreja Matriz");
            const titleColor = isMatriz ? 'text-amber-400' : 'text-amber-100';
            eventDiv.innerHTML = `
                <div class="flex-1">
                    <p class="font-bold text-base ${titleColor}">${event.title}</p>
                    <p class="text-xs text-gray-500">${event.location}</p>
                </div>
                <span class="font-bold text-lg text-amber-500 mr-4">${event.time}</span>
            `;
            listCard.appendChild(eventDiv);
        });
        container.appendChild(listCard);
        lucide.createIcons();
    }

    function switchTab(tabName) {
        currentTab = tabName;
        if (isMenuOpen) toggleMobileMenu();

        document.getElementById('agenda-section').classList.add('hidden');
        document.getElementById('hino-section').classList.add('hidden');
        document.getElementById('oracao-section').classList.add('hidden');
        document.getElementById('info-section').classList.add('hidden');
        document.getElementById('contatos-section').classList.add('hidden');
        document.getElementById(`${tabName}-section`).classList.remove('hidden');

        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        const activeBtn = document.getElementById(`${tabName}-btn`);
        if (activeBtn) activeBtn.classList.add('active');

        if (tabName === 'agenda') {
            renderDatePicker(); 
            renderAgenda(); 
        }
        lucide.createIcons();
    }

    function toggleMobileMenu() {
        isMenuOpen = !isMenuOpen;
        const menuOverlay = document.getElementById('mobile-menu-overlay');
        const menuIconContainer = document.getElementById('mobile-menu-button');
        if (isMenuOpen) {
            menuOverlay.classList.add('open');
            menuIconContainer.innerHTML = `<i data-lucide="x" class="w-6 h-6 text-amber-400"></i>`;
        } else {
            menuOverlay.classList.remove('open');
            menuIconContainer.innerHTML = `<i data-lucide="menu" class="w-6 h-6 text-amber-400"></i>`;
        }
        lucide.createIcons();
    }

    document.addEventListener('DOMContentLoaded', () => {
        getUniqueDates(); 
        switchTab('agenda'); 
        lucide.createIcons();
    });
</script>
